using DistributedRelaxationTimes, Test

frequencies_ = [10.0^i for i in LinRange(-1, 5, 100)]
measurements =  [5919.90084073586 - 15.794826681804063im, 5919.868918957754 - 18.159981630878193im, 5919.826721493486 - 20.879215074112448im, 5919.77094110946 - 24.005490361641563im, 5919.697206534505 - 27.5996700536246im, 5919.59974042323 - 31.731682036223145im, 5919.470907592793 - 36.481851523944236im, 5919.300618498117 - 41.94241925382893im, 5919.075541848076 - 48.21926686986334im, 5918.778065802768 - 55.43387008291376im, 5918.38492835473 - 63.72549788892651im, 5917.865413085487 - 73.25367072511777im, 5917.178975070375 - 84.2008800878181im, 5916.272121651965 - 96.77555401915463im, 5915.074322421108 - 111.21522277959507im, 5913.492660580024 - 127.78979070506573im, 5911.404863326102 - 146.8047445389881im, 5908.650263466139 - 168.6040122409868im, 5905.01815386162 - 193.5720108632083im, 5900.232914230937 - 222.1341623748456im, 5893.935244284243 - 254.7547799128479im, 5885.658880364992 - 291.9306958671349im, 5874.802395994789 - 334.1782808516779im, 5860.596240193616 - 382.01057171273965im, 5842.066282228876 - 435.9001282151594im, 5817.997131602745 - 496.2221448530169im, 5786.901777588199 - 563.1716852011452im, 5747.008971929933 - 636.649541823888im, 5696.286199425884 - 716.1146246637753im, 5632.5229447709735 - 800.40902838821im, 5553.503164244866 - 887.5771603050828im, 5457.291421987694 - 974.7229870738107im, 5342.63571539089 - 1057.9750960758556im, 5209.4450731665065 - 1132.6446972778447im, 5059.236125230311 - 1193.6450875217138im, 4895.386133169998 - 1236.172561118586im, 4723.026713879386 - 1256.5333240114528im, 4548.501342878661 - 1252.8884687705508im, 4378.476213125283 - 1225.659170623928im, 4218.953164799103 - 1177.4357324203618im, 4074.481664971828 - 1112.4265929000287im, 3947.7701493274017 - 1035.6542684768967im, 3839.722530710712 - 952.1595081247917im, 3749.780265405823 - 866.4069866223913im, 3676.396150822044 - 781.9638497571525im, 3617.4939566926623 - 701.420400138136im, 3570.8317812956043 - 626.4733612567127im, 3534.245902976201 - 558.0896645518244im, 3505.788210543568 - 496.6898904301924im, 3483.784725125271 - 442.316077721325im, 3466.8432339785336 - 394.76882902583475im, 3453.8323835170477 - 353.71120514267693im, 3443.847637151783 - 318.7431703076497im, 3436.173566411038 - 289.4525620921043im, 3430.24764536956 - 265.4486049253349im, 3425.627926154446 - 246.38310254978558im, 3421.965311336009 - 231.96331698846592im, 3418.980231849205 - 221.95948932826835im, 3416.4430939302847 - 216.20909421612302im, 3414.1576734237437 - 214.61925725131152im, 3411.946581771727 - 217.16827186968976im, 3409.637927337527 - 223.90678639410245im, 3407.052304085562 - 234.95894874507883im, 3403.989233741757 - 250.523554971262im, 3400.2121579676777 - 270.8750095898293im, 3395.431025444823 - 296.3636315873987im, 3389.281458997103 - 327.41448706936364im, 3381.299451678079 - 364.52344909395174im, 3370.890588381016 - 408.2485221315609im, 3357.293027215301 - 459.19356735128684im, 3339.534079521559 - 517.9803876365069im, 3316.3814761692647 - 585.2036991342916im, 3286.2927015970045 - 661.3619922702401im, 3247.369626855728 - 746.7561190194042im, 3197.3315815837877 - 841.3475891914335im, 3133.5281243349123 - 944.5717302553313im, 3053.0221738121836 - 1055.1096556297796im, 2952.781645138942 - 1170.6404236111093im, 2830.016468891848 - 1287.6225607516105im, 2682.6772534815427 - 1401.1888600099994im, 2510.0812678967413 - 1505.266278330185im, 2313.5507090656965 - 1593.0272636293244im, 2096.8626356612517 - 1657.7095022691499im, 1866.275791227017 - 1693.7003981626112im, 1629.9786274825053 - 1697.6182705539127im, 1397.0038356021628 - 1669.035951938821im, 1175.8894122499416 - 1610.573950641444im, 973.4896731229098 - 1527.326198286415im, 794.2658164284339 - 1425.8394209818277im, 640.1666399505157 - 1312.996963129836im, 510.9874097117643 - 1195.110547896894im, 404.9803160737285 - 1077.3688437226629im, 319.49886763057725 - 963.637281562148im, 251.536931927523 - 856.5140708070351im, 198.10898333966395 - 757.5274334450082im, 156.4775353551784 - 667.3811117725145im, 124.26151768696323 - 586.1900054869882im, 99.46465196353648 - 513.6781103222461im, 80.45690042721759 - 449.3310955471872im, 65.93273498232111 - 392.50667235657im]

λ_opt =  find_optimal_lambda(frequencies_, measurements,method = "discrepancy")

tau_relax  , amps  , taus  , drt  = compute_DRT(frequencies_,measurements,λ =  λ_opt, width_coeff = 0.1 ,method= "re_im")


@testset "DRT.jl" begin
    #test Re-Im discrepancy method for λ estimation. 
    @test λ_opt == 1
    #number of peaks for the example measurements should be 2.
    @test length(tau_relax) == 2
end
